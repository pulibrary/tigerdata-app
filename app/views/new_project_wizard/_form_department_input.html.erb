<div class="form-field departments">
  <%= render partial: "/new_project_wizard/form_field_label",
           locals: {field_label: "Department(s)", field_sub_label: "Required"} %>
  <div class="input-frame">
    <div class="text-input lux-field">
      <div class="horizontal-frame">
        <div class="vertical-frame">
          <div class="lux-field">
            <lux-input-multiselect
                label="Departments"
                hide-label="true"
                selected-items-label=""
                none-selected-label="No departments selected"
                placeholder="Search using department code or name"
                :items='<%= @princeton_departments.map{|dep| {id: dep.code, label: "(#{dep.code}) #{dep.name}", value: dep.name }}.to_json %>'
                :default-values="<%= departments.map{|dep| {id: dep['code'], value: dep['name']}}.to_json %>"
                >
                <template #item="{itemProps}">
                    <div class="info">
                      <lux-badge class="badge">
                        <div class="badge-text">{{ itemProps.id }}</div>
                      </lux-badge>
                      <div class="item-text">{{ itemProps.value }}</div>
                    </div>
                </template>

                <template v-slot:hidden-input="{ selectedItems }">
                  <input v-for="item in selectedItems" type="hidden" name="request[departments][]" :value="JSON.stringify( {'code': item.id, 'name': item.value})" class="selected-item"></input>
                </template>
            </lux-input-multiselect>
          </div>
          <div class="input-error">
               <%= department_error %>
          </div>
          <input type="hidden" id="request-departments" name="request[departments][]" value="" />
        </div>
      </div>
    </div>
  </div>
</div>

<script type="module">
  // Wire the department delete button.
  // Notice that we use the `$(document)` syntax rather than the shorter `$(.remove-department)`
  // because we want to target elements added on the fly and only the `$(document)` syntax
  // works for elements added on the fly.
  $(document).on("click", ".remove-department", (event) => {
    var element = event.target.parentElement;
    $(element).remove();
    return false;
  });
</script>