# Authorization Experiments
## Authorization Options
   * Create a session utilizing the princeton domain & have the user supply their username and password
     * Advantages
       * Requires one call to mediaflux to instatiate the session
       * mediaflux would control user access to the data and commands
     * Disadvantages
       * would either require two logins or for the tigedata app to utilize the mediaflux login instead of single signon
       * less separation from mediaflux and the tigerdata app
   * Create a Identity token to represent the user
     * Advantages
       * Could continue to utilize princeton single signon for tigerdata app
       * keep the tigerdata application and mediaflux more separate
     * Disadvantages
       * Need to control Identity Tokens via the application
       * Could take up to two calls to mediaflux to create a session for a user depending on how long we keep the token active
  * Service Execute with Token 
    You can additionally run commands utilizing a token without creating a session via service execute.  This would eliminate the need for multiple session calls as we would execute any read only commands as tigerdata-app and then run any modification commands as the user utilizing `service.execute :token...`
      * Advantages
        * similar advantages to token login
        * No need to create a separate session for each user for read only operations
        * depending on mediaflux we could have scripts for common commands stored on the server (aka create project could be a script instead of a series of individual commands run from rails)
      * Disadvantages
        * The service execute syntax is more complex than running the command directly
        * Need to control Identity Tokens via the application

## Session Technical Details
  A session is created by passing the user and password to mediaflux.  It is valid until logged out or has been dormant for 30 minutes.

## Token Technical Details
  Tokens are can be shared accross systems.  They could be created in meadiaflux and shared with the tiger-data application, or they can be generated by the application.  The application needs administrative privleges to create tokens.  Tokens can have an expiration date, but they can be created without an expiration date.  They can also be limited by IP address, which would likely be desired so that if they are leaked they are not usful except on our server.  Becuase of their ability to be reused by multiple systems the tokens would need to be kept private by either being generated on the fly or stored in a vaulted file.

## Timing experiments on Docker
  
  Login with an existing token seems to be comparable or slightly faster than login via user name and password.  Creating a new token every time is much slower, because you make twice as many calls.

  Sending service calls with a token does not seem to make the call take a longer time.

  You can see that most timing tests are consistent between localhost and td-meta1, with the exclusion of the session login.  Session login experiment consistently ran worse on td-meta1 (anywhere from the 20 seconds below to 110 seconds).

### By Session
 This test mimics option 1 above.  Basically the user signs in and we create a session.

 * localhost Experiment
    ```
    > rake authorization:by_session       
    1 Session 84.28621292114258 miliseconds 0.08428621292114258 seconds
    1000 Sessions 8345.745086669922 miliseconds 8.345745086669922 seconds
    ```
 * td-meta1 Experiment
    ```
    > bundle exec rake authorization:by_session       
    1 Sesssion 154.8752784729004 mili seconds 0.1548752784729004 seconds
    1000 Sesssions 25164.393424987793 mili seconds 25.164393424987793 seconds
    ```

### By New Token
 This test mimics option 2 above, creating a new token for the user with every login.

 * localhost Experiment
    ```
    > rake authorization:by_new_token     
    1 New Token 121.18387222290039 mili seconds 0.12118387222290039 seconds
    1000 New Tokens 21111.900806427002 mili seconds 21.111900806427002 seconds
    ```
 * td-meta1 Experiment
   ```
   >  bundle exec rake authorization:by_new_token
   1 New Token 28.206348419189453 mili seconds 0.028206348419189453 seconds
   1000 New Tokens 20219.135284423828 mili seconds 20.219135284423828 seconds
   ```

### By Existing Token
 This test mimics option 2 above, storing token for the user and just logging in.
 * localhost Experiment
    ```
    > rake authorization:by_existing_token
    1 Existing Token 20.946979522705078 mili seconds 0.020946979522705078 seconds
    1000 Existing Tokens 7462.0959758758545 mili seconds 7.4620959758758545 seconds
    ```
 * td-meta1 Experiment
   ```
   >  bundle exec rake authorization:by_existing_token
   1 Existing Token 11.101484298706055 mili seconds 0.011101484298706055 seconds
   1000 Existing Tokens 7076.031446456909 mili seconds 7.076031446456909 seconds
   ```

### Service Exec with token
This test calls the service to list namespaces sending an authorization token
 * localhost Experiment
    ```
    > rake authorization:service_with_token    
    1 list namespaces with token 116.86396598815918 mili seconds 0.11686396598815918 seconds
    1000 list namespaces with token 7856.040000915527 mili seconds 7.856040000915527 seconds
    ```
 * td-meta1 Experiment
    ```
    > bundle exec rake authorization:service_with_token
    1 list namespaces with token 10.26296615600586 mili seconds 0.01026296615600586 seconds
    1000 list namespaces with token 7932.947635650635 mili seconds 7.932947635650635 seconds

### Service Exec with out a token
This test calls the service to list namespaces without sending an authorization token
 * localhost Experiment
  ```
  > rake authorization:service_without_token    
  1 list namespaces 20.281076431274414 mili seconds 0.020281076431274414 seconds
  1000 list namespaces 7426.532983779907 mili seconds 7.426532983779907 seconds
  ```
 * td-meta1 Experiment
    ```
  > bundle exec rake authorization:service_without_token
  1 list namespaces 17.622709274291992 mili seconds 0.017622709274291992 seconds
  1000 list namespaces 7543.171167373657 mili seconds 7.543171167373657 seconds
  ```
